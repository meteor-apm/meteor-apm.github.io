<!DOCTYPE html>
<html lang='en'>
<head>
  
    <meta charset="UTF-8">
  <title>How to Optimize Your Methods and Publications - Meteor APM Academy</title>
  <link rel="stylesheet" href="/styles.css">
  <script src="//use.typekit.net/ypr5vji.js"></script>
  <script src="/scripts.js"></script>
  <script>try{Typekit.load();}catch(e){}</script>
</head>
<body>
  
  
    <header id="topbar">
    <div class="container">
      <a href="/" class="logo">Meteor APM</a>
      <nav class="menu">
        
          
            <a href="http://support.meteorapm.com/knowledgebase">Docs</a>
          
        
          
            <a href="/blog">Blog</a>
          
        
          
            <a class="current" href="/academy">Academy</a>
          
        
          
            <a href="http://support.meteorapm.com/forums/224274-general">Support</a>
          
        
      </nav>
    </div>
  </header>

  <section id="main">
    <a href="http://mad.ly/signups/106626/join" class="subscribe">Subscribe to Academy</a>
    <article class="post single post-container">
  
  <h1 class="title">How to Optimize Your Methods and Publications</h1>
  
  <p>This is a general guide that can be used to optimize the response time of your methods and publications. Since this is a general guide only, some of the tips won’t work for you.</p>

<h2 id="see-whats-happening-behind-your-methodpublication">See What’s Happening Behind Your Method/Publication</h2>

<p>With Meteor APM, it is very easy to see what’s happening inside your method/publication and understand what operations cost the most. This is how:
For this example I’m referring to Methods, but you can apply the same process to PubSub as well.</p>

<ul>
  <li>First navigate to the Detailed View section.</li>
  <li>The topmost chart shows the response time of your app. Click on any point in that chart and you’ll see traced method calls just below the chart.</li>
  <li>Click on a trace call and you’ll get a Method Explorer view. This is a graphical stack trace for your method. With that you can identify which operations are responsible for the response time.</li>
</ul>

<p>Watch the following video:</p>

<iframe src="//player.vimeo.com/video/91842608" width="100%" height="500" frameborder="0" webkitallowfullscreen="1" mozallowfullscreen="1" allowfullscreen="1" color="ffffff">
</iframe>

<p>How you can reduce the response time for those operations is shown below.</p>

<h2 id="fetch-foreach-map-count-observe-observechanges">Fetch, ForEach, Map, Count, Observe, ObserveChanges</h2>

<p>This is a DB cursor operation in which you are invoking a query against your collection. Normally it should not take more than <em><strong>200ms</strong></em> to complete an operation of this kind. If it takes longer than that, you can try implementing the following optimizations:</p>

<ul>
  <li>Make sure you’ve added a correct index for your query. Refer to the official <a href="http://docs.mongodb.org/manual/applications/indexes/">MongoDB index guide</a>.</li>
  <li>If the indexes are already working, it may be a network delay. Check that your app and the DB are in the same data center. Are they close enough?</li>
  <li>Your query may return a lot of data. Click the SEE MORE section of the Method/PubSub Explorer to see how many documents you are getting back from the DB. Try to reduce the number of documents you are getting, or reduce the data size.</li>
  <li>You might also be carrying out some DB or similar operations inside a ForEach or Map operation. If so, try to ignore them if possible, or try to find some alternative way.</li>
</ul>

<h2 id="update-remove">Update, Remove</h2>

<ul>
  <li>Update and Remove operations can also take advantage of the index. So, make sure that the selection query is occupying an index. Refer to the official <a href="http://docs.mongodb.org/manual/applications/indexes/">MongoDB index guide</a>.</li>
  <li>You might invoke a query that affects a large set of documents. Try to reduce the number of affected documents if possible.</li>
  <li>Check whether you have too many indexes on your collections. If so, all your indexes need to be updated whenever a document gets changed. This is a costly operation compared with having few indexes. So, try to reduce the number of indexes by using <a href="http://docs.mongodb.org/manual/core/index-compound/">compound indexes</a>.</li>
  <li>Check that your app and the DB are in the same data center. Are they close enough?</li>
</ul>

<h2 id="insert">Insert</h2>

<ul>
  <li>Check whether you have too many indexes on your collections. If so, all your indexes need to be updated when a document gets changed. So, try to reduce the number of indexes by using <a href="http://docs.mongodb.org/manual/core/index-compound/">compound indexes</a>.</li>
  <li>Check that your app and the DB are in the same data center. Are they close enough?</li>
</ul>

<h2 id="higher-http-email-and-async-time">Higher HTTP, Email and Async Time</h2>

<ul>
  <li>Try to add <code>this.unblock</code> to the top of the method (not possible with publications) to avoid other methods and subscriptions being kept waiting on this method. Adding this.unblock is not always possible. Refer to <a href="http://meteorhacks.com/understanding-meteor-wait-time-and-this-unblock.html">this guide</a>.</li>
  <li>If this is a publication, you should not use these kinds of operation. <a href="http://support.meteorapm.com/knowledgebase/articles/347759">See why</a>!</li>
</ul>

<h2 id="higher-wait-time">Higher Wait Time</h2>

<p>This is owing to your method/publication being kept waiting on one or many other methods/publications until those methods are completed. You can click on the SEE MORE button in front of the wait and see what methods and subscriptions you are waiting for.</p>

<p>If you can see what is causing your methods and subscriptions to have a higher response time, try to improve them using this guide.</p>

<p>Sometimes, you are subscribing to several publications at once or calling several methods at once (or a mix of both). If so, having a higher wait time will be familiar to you. If those methods’ throughput is low, you might not need to worry, as the wait time affects only a small number of clients.</p>

<h2 id="higher-compute-time">Higher Compute Time</h2>

<p>This is the time taken for a computation to happen in your app. Since Meteor runs on NodeJS, and NodeJS is based on <a href="http://meteorhacks.com/fibers-eventloop-and-meteor.html">eventloop</a>, all the other operations are getting blocked. It’s wise to optimize your computation or use another algorithm.</p>

<p>These are some of the general guidelines you can apply to your app. But bear in mind that every app is unique and some of these tips might not work for you.</p>

<p>We can have a look at your app. Simply send us an email to <code>help[at]meteorhacks.com</code> with your issue. (Don’t forget to send your appID as well.)</p>

</article>
    <article class="container comments">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'meteorapm'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</article>
  </section>

    <footer id="footer">
    <div class="container">
      <nav class="menu">
        <a href="/terms_and_conditions.html">Terms of Service</a>
        <a href="/privacy_policy.html">Privacy Policy</a>
      </nav>
      <br style="clear:both">
    </div>
  </footer>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-48364339-2', 'meteorapm.com');
    ga('send', 'pageview');
  </script>

</body>
</html>